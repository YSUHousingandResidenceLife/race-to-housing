<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Housing Logo Overlay (aesthetic only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    :root { --card:#fff; --border:#e5e7eb; --shadow:0 10px 24px rgba(0,0,0,.12); }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    #map{position:absolute; inset:0}
    .ui{
      position:absolute; right:12px; top:12px; z-index:20; width:min(360px,92vw);
      background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow);
    }
    .ui header{padding:12px 14px; border-bottom:1px solid var(--border); font-weight:700}
    .ui .body{padding:12px 14px; display:grid; gap:10px}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    button{cursor:pointer; border:1px solid var(--border); background:#fff; padding:8px 10px; border-radius:8px; font-weight:600}
    button.primary{background:#d6001c; color:#fff; border-color:#c21a1a}
    .muted{color:#4b5563; font-size:13px}
    .badge{display:inline-grid; place-items:center; width:22px; height:22px; border-radius:50%; background:#d6001c; color:#fff; font-size:12px; font-weight:700}
    .steps{display:grid; gap:8px}
    .step{display:grid; grid-template-columns:auto 1fr; gap:8px; align-items:flex-start}
    input[type="range"]{width:180px}
    .hint{background:#f9fafb; border:1px dashed #e5e7eb; padding:8px 10px; border-radius:8px; font-size:13px}
  </style>
</head>
<body>
  <div id="map"></div>

  <section class="ui">
    <header>Place Housing Logo (overlay only)</header>
    <div class="body">
      <div class="steps">
        <div class="step"><span class="badge">1</span><div>Click <b>Place / Re-place Logo</b>, then click <b>Top-Left</b>, <b>Top-Right</b>, <b>Bottom-Right</b> corners on the map.</div></div>
        <div class="step"><span class="badge">2</span><div>Adjust <b>Opacity</b> or <b>Hide/Show</b>. Remove anytime.</div></div>
      </div>

      <div class="row">
        <button id="btnPlace" class="primary">Place / Re-place Logo</button>
        <button id="btnHide">Hide</button>
        <button id="btnShow">Show</button>
        <button id="btnRemove">Remove</button>
      </div>

      <div class="row">
        <label class="muted">Opacity:</label>
        <input id="opacity" type="range" min="0" max="1" step="0.02" value="0.85" />
        <span id="opval" class="muted">0.85</span>
      </div>

      <div id="status" class="hint">Ready. File expected: <code>housing-overlay.png</code> in this folder.</div>
    </div>
  </section>

  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
  <script>
    // ====== MAP SETUP ======
    mapboxgl.accessToken =
      'pk.eyJ1IjoieXN1LWhybCIsImEiOiJjbWZtcjVkNXUwNTJkMmxvaDZpaTF6b2x2In0.8-4W7BoAy5GmwM2_-L_Jzw';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/ysu-hrl/cmfpr50qm00a401ry0uzb5b1q',
      center: [-80.6458, 41.1090],
      zoom: 16.8,
      pitch: 60,
      bearing: -133.6,
      minZoom: 15,
      maxZoom: 19,
      maxBounds: [[-80.6570, 41.1026], [-80.6415, 41.1120]]
    });
    map.addControl(new mapboxgl.NavigationControl(), 'top-right');

    // Optional: hide map labels to make the overlay pop
    function hideLabels() {
      const layers = map.getStyle().layers || [];
      for (const lyr of layers) {
        if (lyr.type === 'symbol' || /label/i.test(lyr.id)) {
          try { map.setLayoutProperty(lyr.id, 'visibility', 'none'); } catch(e){}
        }
      }
    }
    map.on('styledata', () => hideLabels());

    // ====== OVERLAY LOGIC (image source with 4 corners) ======
    const SOURCE_ID = 'housing-logo-src';
    const LAYER_ID  = 'housing-logo-layer';
    const IMG_URL   = 'housing-overlay.png'; // <- put your image here (same folder)

    let placing = false;
    let clicks = []; // TL, TR, BR

    const statusEl = document.getElementById('status');
    const opSlider = document.getElementById('opacity');
    const opVal = document.getElementById('opval');

    function setStatus(msg) { statusEl.textContent = msg; }

    function ensureLayer() {
      if (!map.getSource(SOURCE_ID)) {
        map.addSource(SOURCE_ID, {
          type: 'image',
          url: IMG_URL,
          // temp 1x1 until user clicks three corners
          coordinates: [
            [-80.6460, 41.1095], // TL
            [-80.6458, 41.1095], // TR
            [-80.6458, 41.1093], // BR
            [-80.6460, 41.1093]  // BL
          ]
        });
      }
      if (!map.getLayer(LAYER_ID)) {
        map.addLayer({
          id: LAYER_ID,
          type: 'raster',
          source: SOURCE_ID,
          paint: {
            'raster-opacity': parseFloat(opSlider.value),
            'raster-fade-duration': 0
          }
        });
      }
    }

    function updateOpacity() {
      opVal.textContent = parseFloat(opSlider.value).toFixed(2);
      if (map.getLayer(LAYER_ID)) {
        map.setPaintProperty(LAYER_ID, 'raster-opacity', parseFloat(opSlider.value));
      }
    }
    opSlider.addEventListener('input', updateOpacity);

    function startPlacing() {
      ensureLayer();
      placing = true;
      clicks = [];
      setStatus('Placing… Click TOP-LEFT, then TOP-RIGHT, then BOTTOM-RIGHT of the logo area.');
      map.getCanvas().style.cursor = 'crosshair';
    }

    function finishPlacement() {
      if (clicks.length < 3) return;
      const [TL, TR, BR] = clicks;
      // compute BL = TL + (BR - TR)
      const BL = [ TL[0] + (BR[0] - TR[0]), TL[1] + (BR[1] - TR[1]) ];

      const coords = [TL, TR, BR, BL];
      map.getSource(SOURCE_ID).setCoordinates(coords);
      placing = false;
      clicks = [];
      map.getCanvas().style.cursor = '';
      setStatus('Logo placed. Use opacity slider or Place / Re-place to adjust.');
    }

    map.on('click', (e) => {
      if (!placing) return;
      const pt = [e.lngLat.lng, e.lngLat.lat];
      clicks.push(pt);
      if (clicks.length === 1) setStatus('TL saved. Now click TOP-RIGHT.');
      if (clicks.length === 2) setStatus('TR saved. Now click BOTTOM-RIGHT.');
      if (clicks.length === 3) finishPlacement();
    });

    // Buttons
    document.getElementById('btnPlace').onclick = () => startPlacing();
    document.getElementById('btnHide').onclick  = () => {
      if (map.getLayer(LAYER_ID)) map.setLayoutProperty(LAYER_ID, 'visibility', 'none');
    };
    document.getElementById('btnShow').onclick  = () => {
      ensureLayer();
      map.setLayoutProperty(LAYER_ID, 'visibility', 'visible');
      updateOpacity();
    };
    document.getElementById('btnRemove').onclick = () => {
      if (map.getLayer(LAYER_ID)) map.removeLayer(LAYER_ID);
      if (map.getSource(SOURCE_ID)) map.removeSource(SOURCE_ID);
      placing = false; clicks = [];
      setStatus('Overlay removed. Click “Place / Re-place Logo” to add it again.');
    };

    map.on('load', () => {
      // keep labels off for a clean look
      hideLabels();
      setStatus('Ready. Click “Place / Re-place Logo” and set 3 corners.');
      updateOpacity();
    });
  </script>
</body>
</html>
